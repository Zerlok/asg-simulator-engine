<!DOCTYPE html>
<html>
<head>
	<meta http-equiv="content-type" content="text/html;charset=utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1, user-scalable=no"/>

	<link href="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css" rel="stylesheet">
	<link href="//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css" rel="stylesheet">
	<link href="//fonts.googleapis.com/css?family=Lato:400,700" rel="stylesheet">

	<link rel="stylesheet" href="/static/libs/jsPlumb/css/jsPlumbToolkit-defaults.css">
	<link rel="stylesheet" href="/static/libs/jsPlumb/css/main.css">
	<link rel="stylesheet" href="/static/libs/jsPlumb/css/jsPlumbToolkit-demo.css">
	<link rel="stylesheet" href="/static/css/nodes.css">

	<script src="//cdnjs.cloudflare.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
	<script src="//cdnjs.cloudflare.com/ajax/libs/jqueryui/1.9.2/jquery-ui.min.js"></script>
	<script src="/static/libs/jsPlumb/jsPlumb-2.2.8-min.js"></script>
</head>
<body>
	<p>Choose strategy:</p>
	<select>
		<option onclick="loadStrategy('attacker.json');">Attacker</option>
		<option onclick="loadStrategy('defender.json');">Defender</option>
	</select>
	<button onclick="saveStrategy()">Save</button>
	<button onclick="nodeEditor.clearAll()">Clear</button>
	<button onclick="gatherAllData()">Data gather</button>

	<p>Add node:</p>
	<select>
		<option onclick="nodeEditor.createNode('root');">Root</option>
		<option onclick="nodeEditor.createNode('filter');">Filter</option>
		<option onclick="nodeEditor.createNode('manipulator');">Manipulator</option>
		<option onclick="nodeEditor.createNode('conditional');">Conditional</option>
		<option onclick="nodeEditor.createNode('fork');">Fork</option>
		<option onclick="nodeEditor.createNode('cmdFire');">Cmd Fire</option>
		<option onclick="nodeEditor.createNode('cmdHold');">Cmd Hold</option>
	</select>

	<div class="jtk-demo-canvas canvas-wide flowchart-demo jtk-surface jtk-surface-nopan" id="asg-node-container">
		<!-- ASG nodes here -->
	</div>

	<script>
		$.getJSON("/nodes/config", function(data) {
			nodeEditor.cfg = data;
		});

		var stratName;
		function saveStrategy() {
			// TODO: save
			$.ajax({
				type: "GET",
				dataType : 'json',
				async: false,
				url: "/nodes/save",
				data: { name: stratName, nodes: nodeEditor.toJson() },
				success: function () { alert("Thanks!"); },
				failure: function() { alert("Error!");}
			});
		}
		function nodeLoader(data) {
			console.log("Strategy data:");
			console.log(data);
			nodeEditor.fromJson(data);
		}
		function loadStrategy(name) {
			stratName = name;
			console.log(`Loading ${name} strategy...`);
			$.getJSON("/public/"+stratName, nodeLoader);
		}

		function gatherAllData() {
			console.log(nodeEditor.nodes[0].getValues());
		}
	</script>
	<script src="/static/js/viewer.js"></script>

</body>
</html>
